<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Clean Share Link</title>
  <link rel="stylesheet" href="styles.css" />
  <meta name="description" content="Remove UTM and tracking junk from URLs before sharing." />

  <!-- FastSpring popup (hosted checkout) -->
  <script
    id="fsc-api"
    src="https://sbl.onfastspring.com/sbl/1.0.5/fastspring-builder.min.js"
    type="text/javascript"
    data-storefront="cleansharelink.test.onfastspring.com/popup-cleansharelink"
    data-popup-closed="onFSPopupClosed">
  </script>
</head>
<body>
  <header class="site-header">
    <div class="brand">
      <div class="logo-dot" aria-hidden="true"></div>
      <h1>Clean Share Link</h1>
    </div>
    <div class="hdr-actions">
      <span id="affCredits" class="badge-credits" title="Affiliate CSV credits">AFF: 0</span>
      <button id="proBadge" class="badge-pro" aria-label="Pro info">Pro</button>
    </div>
  </header>

  <main class="wrap">
    <section class="card">
      <h2 class="card-title">Paste a link, get it clean</h2>
      <p class="muted">
        Remove UTM/FBCLID/GCLID and other tracking parameters. Everything happens locally in your browser.
      </p>

      <label for="urlIn" class="label">URL to clean</label>
      <textarea id="urlIn" class="input" rows="3" placeholder="https://example.com/page?utm_source=x&gclid=..."></textarea>

      <div class="toggles">
        <label class="toggle">
          <input type="checkbox" id="forceHttps" checked />
          <span>Force HTTPS</span>
        </label>
        <label class="toggle">
          <input type="checkbox" id="keepParams" checked />
          <span>Keep site params (remove only tracking junk)</span>
        </label>
      </div>

      <div class="actions">
        <button id="cleanBtn" class="btn primary">Clean</button>
        <button id="resetBtn" class="btn subtle">Reset</button>
        <div class="spacer"></div>
        <div id="quota" class="quota">3 free cleans left today</div>
      </div>

      <div id="status" class="status" role="status" aria-live="polite"></div>

      <div class="result">
        <label for="urlOut" class="label">Clean URL</label>
        <textarea id="urlOut" class="output" rows="2" readonly placeholder="Your clean URL will appear here"></textarea>
        <div class="result-actions">
          <button id="copyBtn" class="btn">Copy</button>
          <button id="openBtn" class="btn">Open</button>
        </div>
      </div>

      <hr class="sep" />

      <!-- BATCH (Pro feature when locked) -->
      <div class="batch pro-locked" aria-disabled="true">
        <div class="batch-head">
          <h3 class="batch-title">Batch</h3>
          <span class="badge-lock" aria-hidden="true">Pro</span>
        </div>
        <p class="muted small">
          Paste 10–100 URLs (one per line) and clean them all at once.
        </p>
        <textarea id="batchIn" class="input ghost" rows="4" placeholder="One URL per line…"></textarea>
        <div class="result-actions">
          <button id="batchCleanBtn" class="btn ghost">Clean Batch</button>
          <button id="batchExportBtn" class="btn ghost">Export CSV</button>
        </div>
      </div>

      <hr class="sep" />

      <!-- SubID Matrix Tracker (Affiliate mode) -->
      <div class="smt">
        <div class="smt-head">
          <h3 class="batch-title">SubID Matrix Tracker</h3>
          <span class="badge beta">beta</span>
        </div>
        <p class="muted small">
          Generate channel-tagged affiliate links in bulk (local-only). Analyze is free; CSV export costs 1 credit.
        </p>

        <div class="toggles">
          <label class="toggle">
            <input type="checkbox" id="smtEnable" />
            <span>Enable SubID Matrix</span>
          </label>
          <label class="toggle">
            <input type="checkbox" id="keepUtms" />
            <span>Keep UTM params</span>
          </label>
        </div>

        <label for="channelsIn" class="label">Channels (one per line)</label>
        <textarea id="channelsIn" class="input" rows="3" placeholder="youtube_desc&#10;ig_bio&#10;tiktok_profile&#10;newsletter_aug"></textarea>

        <div class="result-actions">
          <button id="smtAnalyzeBtn" class="btn">Analyze (free)</button>
          <button id="smtExportBtn" class="btn primary">Export SubID CSV (–1 credit)</button>
          <div class="spacer"></div>
          <button id="buyAffBtn" class="btn subtle" title="Buy affiliate CSV credits">Buy credits</button>
        </div>

        <div id="smtPreview" class="smt-preview muted small"></div>
      </div>

    </section>

    <footer class="foot muted">
      <span>Local-only • No tracking • No external requests</span>
    </footer>
  </main>

  <!-- Pro Modal -->
  <div id="modalBackdrop" class="modal-backdrop" hidden></div>
  <dialog id="proModal" class="modal" aria-labelledby="modalTitle">
    <h3 id="modalTitle">Unlock Pro</h3>
    <p class="muted">
      You’re on the free version. Pro gives you unlimited cleans, custom rule lists, and batch mode.
    </p>
    <ul class="list">
      <li>Unlimited cleans</li>
      <li>Custom removal rules</li>
      <li>Batch: paste 10–100 links</li>
    </ul>
    <div class="modal-actions" style="flex-wrap:wrap;gap:10px">
      <!-- FastSpring: open checkout via script -->
      <button id="upgradePro" class="btn primary">Upgrade to Pro</button>
      <button id="closeModal" class="btn">Close</button>
    </div>
  </dialog>

  <!-- helper: set .is-pro on <html> if Pro -->
  <script>
    (function(){
      function apply(){
        try{
          if (localStorage.getItem('csl_pro_v1') === '1') {
            document.documentElement.classList.add('is-pro');
          }
        }catch{}
        // show AFF credits
        try{
          var n = Number(localStorage.getItem('csl_aff_credits')||0);
          var el = document.getElementById('affCredits');
          if (el) el.textContent = 'AFF: ' + (isFinite(n)?n:0);
        }catch{}
      }
      apply();
      window.addEventListener('message', apply);
      window.addEventListener('storage', apply);
    })();
  </script>

  <script src="ui.js"></script>
</body>
</html>
